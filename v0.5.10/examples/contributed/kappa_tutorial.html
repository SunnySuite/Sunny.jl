<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Enforcing the quantum sum rule with moment renormalization · Sunny documentation</title><meta name="title" content="Enforcing the quantum sum rule with moment renormalization · Sunny documentation"/><meta property="og:title" content="Enforcing the quantum sum rule with moment renormalization · Sunny documentation"/><meta property="twitter:title" content="Enforcing the quantum sum rule with moment renormalization · Sunny documentation"/><meta name="description" content="Documentation for Sunny documentation."/><meta property="og:description" content="Documentation for Sunny documentation."/><meta property="twitter:description" content="Documentation for Sunny documentation."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../index.html"><img class="docs-light-only" src="../../assets/logo.svg" alt="Sunny documentation logo"/><img class="docs-dark-only" src="../../assets/logo-dark.svg" alt="Sunny documentation logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../index.html">Sunny documentation</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../index.html">Overview</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../01_LSWT_SU3_FeI2.html">1. Multi-flavor spin wave simulations of FeI₂ (Showcase)</a></li><li><a class="tocitem" href="../02_LSWT_CoRh2O4.html">2. Spin wave simulations of CoRh₂O₄</a></li><li><a class="tocitem" href="../03_LLD_CoRh2O4.html">3. Landau-Lifshitz dynamics of CoRh₂O₄ at finite <em>T</em></a></li><li><a class="tocitem" href="../04_GSD_FeI2.html">4. Generalized spin dynamics of FeI₂ at finite <em>T</em></a></li><li><a class="tocitem" href="../05_MC_Ising.html">5. Monte Carlo sampling of the Ising model</a></li><li><a class="tocitem" href="../06_CP2_Skyrmions.html">6. Dynamical quench into CP² skyrmion liquid</a></li><li><a class="tocitem" href="../07_Dipole_Dipole.html">7. Long-range dipole interactions</a></li><li><input class="collapse-toggle" id="menuitem-2-8" type="checkbox"/><label class="tocitem" for="menuitem-2-8"><span class="docs-label">SpinW tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../spinw/SW08_Kagome_AFM.html">SW8 - Kagome Antiferromagnet</a></li><li><a class="tocitem" href="../spinw/SW15_Ba3NbFe3Si2O14.html">SW15 - Ba₃NbFe₃Si₂O₁₄</a></li><li><a class="tocitem" href="../spinw/SW18_Distorted_kagome.html">SW18 - Distorted kagome</a></li><li><a class="tocitem" href="../spinw/SW19_Different_Ions.html">SW19 - Different magnetic ions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-9" type="checkbox" checked/><label class="tocitem" for="menuitem-2-9"><span class="docs-label">Contributed</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="MgCr2O4-tutorial.html">MgCr2O4 at Finite Temperature</a></li><li class="is-active"><a class="tocitem" href="kappa_tutorial.html">Enforcing the quantum sum rule with moment renormalization</a><ul class="internal"><li><a class="tocitem" href="#Evaluating-spectral-sums-in-Sunny"><span>Evaluating spectral sums in Sunny</span></a></li><li><a class="tocitem" href="#Implementing-moment-renormalization"><span>Implementing moment renormalization</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-10" type="checkbox"/><label class="tocitem" for="menuitem-2-10"><span class="docs-label">Advanced</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../parallelism.html">Parallelizing Calculations</a></li><li><a class="tocitem" href="../../writevtk.html">ParaView Rendering</a></li></ul></li></ul></li><li><span class="tocitem">Modeling Guides</span><ul><li><a class="tocitem" href="../../structure-factor.html">Structure Factor Calculations</a></li><li><a class="tocitem" href="../../renormalization.html">Interaction Strength Renormalization</a></li></ul></li><li><a class="tocitem" href="../../library.html">Library API</a></li><li><a class="tocitem" href="../../versions.html">Version History</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li><a class="is-disabled">Contributed</a></li><li class="is-active"><a href="kappa_tutorial.html">Enforcing the quantum sum rule with moment renormalization</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="kappa_tutorial.html">Enforcing the quantum sum rule with moment renormalization</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SunnySuite/Sunny.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SunnySuite/Sunny.jl/blob/main/docs/src/examples/contributed/kappa_tutorial.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Enforcing-the-quantum-sum-rule-with-moment-renormalization"><a class="docs-heading-anchor" href="#Enforcing-the-quantum-sum-rule-with-moment-renormalization">Enforcing the quantum sum rule with moment renormalization</a><a id="Enforcing-the-quantum-sum-rule-with-moment-renormalization-1"></a><a class="docs-heading-anchor-permalink" href="#Enforcing-the-quantum-sum-rule-with-moment-renormalization" title="Permalink"></a></h1><p>One goal of the Sunny project is to extend classical techniques to incorporate a greater number of quantum effects. The generalization of the Landau-Lifshitz (LL) equations from SU(2) to SU(<span>$N$</span>) coherent states is the cornerstone of this approach [1], but Sunny includes a number of other &quot;classical-to-quantum&quot; corrections. For example, in the zero-temperature limit, there is a well-known correspondence between Linear Spin Wave Theory (LSWT) and the quantization of the normal modes of the linearized LL equations. This allows the dynamical spin structure factor (DSSF) that would be calculated with LSWT, <span>$\mathcal{S}_{\mathrm{Q}}(\mathbf{q}, \omega)$</span>, to be recovered from a DSSF that has been calculated classically, <span>$\mathcal{S}_{\mathrm{cl}}(\mathbf{q}, \omega)$</span>. This is achieved by applying a classical-to-quantum correspondence factor to <span>$\mathcal{S}_{\mathrm{cl}}(\mathbf{q}, \omega)$</span>:</p><p class="math-container">\[\mathcal{S}_{\mathrm{Q}}(\mathbf{q}, \omega)=\frac{\hbar\omega}{k_{\mathrm{B}} T} \left[1+ n_{\mathrm{B}}(\omega/T) \right] \mathcal{S}_{\mathrm{cl}}(\mathbf{q}, \omega),\]</p><p>Sunny automatically applies this correction when you provide an <code>intensity_formula</code> with a temperature. This will be demonstrated in the code example below.</p><p>The quantum structure factor satisfies a familiar &quot;zeroth-moment&quot; sum rule,</p><p class="math-container">\[\int\int d\mathbf{q}d\omega\mathcal{S}_{\mathrm{Q}}(\mathbf{q}, \omega) = N_S S(S+1),\]</p><p>where <span>$N_S$</span> is the number of sites. An immediate consequence of the correspondence is that the &quot;corrected&quot; classical structure factor satisfies the same sum rule:</p><p class="math-container">\[\int\int d\mathbf{q}d\omega \frac{\hbar\omega}{k_{\mathrm{B}} T} \left[1+ n_{\mathrm{B}}(\omega/T) \right] \mathcal{S}_{\mathrm{cl}}(\mathbf{q}, \omega) = N_S S(S+1)\]</p><p>Note, however, that this correspondence depends on a harmonic oscillator approximation and only applies near <span>$T=0$</span>. This is reflected in the fact that the correction factor,</p><p class="math-container">\[\frac{\hbar\omega}{k_{\mathrm{B}} T} \left[1+ n_{\mathrm{B}}(\omega/T) \right],\]</p><p>approaches unity for all <span>$\omega$</span> whenever <span>$T$</span> grows large. In particular, this means that the corrected classical <span>$\mathcal{S}_{\mathrm{cl}}(\mathbf{q}, \omega)$</span> will no longer satisfy the quantum sum rule at elevated temperatures. It will instead approach the &quot;classical sum rule&quot;:</p><p class="math-container">\[\lim_{T\rightarrow\infty}\int\int d\mathbf{q}d\omega \frac{\hbar\omega}{k_{\mathrm{B}} T} \left[1+ n_{\mathrm{B}}(\omega/T) \right] \mathcal{S}_{\mathrm{cl}}(\mathbf{q}, \omega) = N_S S^2
\]</p><p>A simple approach to maintaining a classical-to-quantum correspondence at elevated temperatures is to renormalize the classical magnetic moments so that the quantum sum rule is satisfied. The renormalization factor can be determinied analytically in the infinite temperature limit [2]. For an arbitrary temperature, however, it must be determined empirically [3]. While determining an appropriate rescaling factor can be computationally expensive, Sunny makes it straightforward to evaluate spectral sums and apply moment renormalization, as shown below. One approach to determining the rescaling factors themselves is demonstrated in the sample code <a href="https://github.com/SunnySuite/2023-Dahlbom-Quantum_to_classical_crossover">here</a>.</p><h2 id="Evaluating-spectral-sums-in-Sunny"><a class="docs-heading-anchor" href="#Evaluating-spectral-sums-in-Sunny">Evaluating spectral sums in Sunny</a><a id="Evaluating-spectral-sums-in-Sunny-1"></a><a class="docs-heading-anchor-permalink" href="#Evaluating-spectral-sums-in-Sunny" title="Permalink"></a></h2><p>We&#39;ll begin by building a spin system representing the effective Spin-1 compound FeI2.</p><pre><code class="language-julia hljs">using Sunny, LinearAlgebra
include(joinpath(@__DIR__, &quot;..&quot;, &quot;src&quot;, &quot;kappa_supplementals.jl&quot;))

dims = (8, 8, 4)
seed = 101
sys, cryst = FeI2_sys_and_cryst(dims; seed);</code></pre><p>We will next estimate <span>$\mathcal{S}_{\mathrm{cl}}(\mathbf{q}, \omega)$</span> using classical dynamics. (For more details on setting up such a calculation, see the tutorials in the official Sunny documentation.)</p><pre><code class="language-julia hljs"># Parameters for generating equilbrium samples.
Δt_therm = 0.004                      # Step size for Langevin integrator
dur_therm = 10.0                      # Safe thermalization time
λ = 0.1                               # Phenomenological coupling to thermal bath
kT = 0.1 * Sunny.meV_per_K            # Simulation temperature
langevin = Langevin(Δt_therm; λ, kT)  # Langevin integrator

# Parameters for sampling correlations.
Δt = 0.025          # Integrator step size for dissipationless trajectories
ωmax = 10.0         # Maximum energy to resolve
nω = 200            # Number of energy bins
nsamples = 3        # Number of dynamical trajectories to collect for estimating S(𝐪,ω)

# Since FeI2 is a Spin-1 material, we&#39;ll need a complete set of observables for SU($2S+1=3$)
# with which to calculate correlations.
Sx, Sy, Sz = spin_matrices(1)  # Spin-1 representation of spin operators
observables = [
    Sx,
    Sy,
    Sz,
    -(Sx*Sz + Sz*Sx),
    -(Sy*Sz + Sz*Sy),
    Sx^2 - Sy^2,
    Sx*Sy + Sy*Sx,
    √3 * Sz^2 - I*2/√3,
]

# Build the `SampledCorrelations` object to hold calculation results.
sc = dynamical_correlations(sys; Δt, nω, ωmax, observables)

# Thermalize and add several samples
for _ in 1:5_000
    step!(sys, langevin)
end

for _ in 1:nsamples
    # Decorrelate sample
    for _ in 1:2_000
        step!(sys, langevin)
    end
    add_sample!(sc, sys)
end</code></pre><p><code>sc</code> now contains an estimate of <span>$\mathcal{S}_{\mathrm{cl}}(\mathbf{q}, \omega)$</span>. We next wish to evaluate the total spectral weight. We are working on a finite lattice and using discretized dynamics, so the integral will reduce to a sum. Since we&#39;ll be evaluating this sum repeatedly, we&#39;ll define a function.</p><pre><code class="language-julia hljs">function total_spectral_weight(sc::SampledCorrelations; kT = Inf)
    # Retrieve all available discrete wave vectors in the first Brillouin zone.
    qs = available_wave_vectors(sc)

    # Set up a formula to tell Sunny how to calculate intensities. For
    # evaluating the sum rule, we want to take the trace over S(𝐪,ω).
    # Setting `kT` to something other than `Inf` will result in the application
    # temperature corrections.
    formula = intensity_formula(sc, :trace; kT)

    # Calculate the intensities. Note that we must include negative energies to
    # evaluate the total spectral weight.
    is = intensities_interpolated(sc, qs, formula; interpolation=:round, negative_energies=true)

    return sum(is)
end;</code></pre><p>Now evaluate the total spectral weight without temperature corrections.</p><pre><code class="language-julia hljs">total_spectral_weight(sc; kT=Inf) / prod(sys.latsize)</code></pre><pre><code class="nohighlight hljs">1.3333333333333337</code></pre><p>The result is 4/3, which is the expected &quot;classical&quot; sum rule. This reference can be established by evaluating <span>$\sum_{\alpha}\langle Z\vert T^{\alpha} \vert Z \rangle^2$</span> for any SU(3) coherent state <span>$Z$</span>, with <span>$T^{\alpha}$</span> a complete set of generators of SU(3) – for example, the <code>observables</code> above. However, the quantum sum rule is in fact 16/3, as can be determined by directly calculating <span>$\sum_{\alpha}(T^{\alpha})^2$</span>.</p><p>Now let&#39;s try again, this time applying the classical-to-quantum correspondence factor by providing the simulation temperature.</p><pre><code class="language-julia hljs">total_spectral_weight(sc; kT) / prod(sys.latsize)</code></pre><pre><code class="nohighlight hljs">5.3454553947623955</code></pre><p>This is in fact very close to 16/3. So, at low temperatures, application of the classical-to-quantum correspondence factor yields results that (approximately) satisfy the quantum sum rule.</p><p>This will no longer hold at higher temperatures. Let&#39;s repeat the above experiment with a simulation temperature above <span>$T_N=3.05$</span>.</p><pre><code class="language-julia hljs">sys, cryst = FeI2_sys_and_cryst(dims; seed)
kT = 3.5 * Sunny.meV_per_K
langevin = Langevin(Δt_therm; λ, kT)
sc = dynamical_correlations(sys; Δt, nω, ωmax, observables)

# Thermalize
for _ in 1:5_000
    step!(sys, langevin)
end

for _ in 1:nsamples
    # Decorrelate sample
    for _ in 1:2_000
        step!(sys, langevin)
    end
    add_sample!(sc, sys)
end</code></pre><p>Evaluating the sum without the classical-to-quantum correction factor will again give 4/3, as you can easily verify. Let&#39;s examine the result with the correction:</p><pre><code class="language-julia hljs">total_spectral_weight(sc; kT) / prod(sys.latsize)</code></pre><pre><code class="nohighlight hljs">2.9237215440928477</code></pre><p>While this is larger than the classical value of 4/3, it is still substantially short of the quantum value of 16/3.</p><h2 id="Implementing-moment-renormalization"><a class="docs-heading-anchor" href="#Implementing-moment-renormalization">Implementing moment renormalization</a><a id="Implementing-moment-renormalization-1"></a><a class="docs-heading-anchor-permalink" href="#Implementing-moment-renormalization" title="Permalink"></a></h2><p>One way to enforce the quantum sum rule is by simply renormalizing the magnetic moments. In Sunny, this can be achieved by calling <code>set_spin_rescaling!(sys, κ)</code>, where κ is the desired renormalization. Let&#39;s repeat the calculation above at the same temperature, this time setting <span>$κ=1.25$</span>.</p><pre><code class="language-julia hljs">sys, cryst = FeI2_sys_and_cryst(dims; seed)
sc = dynamical_correlations(sys; Δt, nω, ωmax, observables)
κ = 1.25

# Thermalize
for _ in 1:5_000
    step!(sys, langevin)
end

for _ in 1:nsamples
    # Generate new equilibrium sample.
    for _ in 1:2_000
        step!(sys, langevin)
    end

    # Renormalize magnetic moments before collecting a time-evolved sample.
    set_spin_rescaling!(sys, κ)

    # Generate a trajectory and calculate correlations.
    add_sample!(sc, sys)

    # Turn off κ renormalization before generating a new equilibrium sample.
    set_spin_rescaling!(sys, 1.0)
end</code></pre><p>Finally, we evaluate the sum:</p><pre><code class="language-julia hljs">total_spectral_weight(sc; kT) / prod(sys.latsize)</code></pre><pre><code class="nohighlight hljs">5.190400851435814</code></pre><p>The result is something slightly greater than 5, substantially closer to the expected quantum sum rule. We can now adjust <span>$\kappa$</span> and iterate until we reach a value sufficiently close to 16/3.  In general, this should be done while collecting substantially more statistics.</p><p>Note that <span>$\kappa (T)$</span> needs to be determined empirically for each model. A detailed example, demonstrating the calculations used in [3], is available <a href="https://github.com/SunnySuite/2023-Dahlbom-Quantum_to_classical_crossover">here</a>.</p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><p>[1] - <a href="https://journals.aps.org/prb/abstract/10.1103/PhysRevB.104.104409">H. Zhang, C. D. Batista, &quot;Classical spin dynamics based on SU(N) coherent states,&quot; PRB (2021)</a></p><p>[2] - <a href="https://iopscience.iop.org/article/10.1088/1742-5468/2008/05/P05017/meta">T. Huberman, D. A. Tennant, R. A. Cowley, R. Coldea and C. D. Frost, &quot;A study of the quantum classical crossover in the spin dynamics of the 2D S = 5/2 antiferromagnet Rb2MnF4: neutron scattering, computer simulations and analytic theories&quot; (2008)</a></p><p>[3] - <a href="https://arxiv.org/abs/2310.19905">D. Dahlbom, D. Brooks, M. S. Wilson, S. Chi, A. I. Kolesnikov, M. B. Stone, H. Cao, Y.-W. Li, K. Barros, M. Mourigal, C. D. Batista, X. Bai, &quot;Quantum to classical crossover in generalized spin systems,&quot; arXiv:2310.19905 (2023)</a></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="MgCr2O4-tutorial.html">« MgCr2O4 at Finite Temperature</a><a class="docs-footer-nextpage" href="../../parallelism.html">Parallelizing Calculations »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Tuesday 28 May 2024 04:32">Tuesday 28 May 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
