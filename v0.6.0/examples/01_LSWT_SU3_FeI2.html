<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>1. Multi-flavor spin wave simulations of FeI‚ÇÇ (Showcase) ¬∑ Sunny documentation</title><meta name="title" content="1. Multi-flavor spin wave simulations of FeI‚ÇÇ (Showcase) ¬∑ Sunny documentation"/><meta property="og:title" content="1. Multi-flavor spin wave simulations of FeI‚ÇÇ (Showcase) ¬∑ Sunny documentation"/><meta property="twitter:title" content="1. Multi-flavor spin wave simulations of FeI‚ÇÇ (Showcase) ¬∑ Sunny documentation"/><meta name="description" content="Documentation for Sunny documentation."/><meta property="og:description" content="Documentation for Sunny documentation."/><meta property="twitter:description" content="Documentation for Sunny documentation."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../index.html"><img class="docs-light-only" src="../assets/logo.svg" alt="Sunny documentation logo"/><img class="docs-dark-only" src="../assets/logo-dark.svg" alt="Sunny documentation logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">Sunny documentation</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Overview</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href="01_LSWT_SU3_FeI2.html">1. Multi-flavor spin wave simulations of FeI‚ÇÇ (Showcase)</a><ul class="internal"><li><a class="tocitem" href="#Get-Julia-and-Sunny"><span>Get Julia and Sunny</span></a></li><li><a class="tocitem" href="#Crystals"><span>Crystals</span></a></li><li><a class="tocitem" href="#Symmetry-analysis"><span>Symmetry analysis</span></a></li><li><a class="tocitem" href="#Building-a-spin-System"><span>Building a spin System</span></a></li><li class="toplevel"><a class="tocitem" href="#Calculating-structure-factor-intensities"><span>Calculating structure factor intensities</span></a></li><li><a class="tocitem" href="#Finding-the-ground-state"><span>Finding the ground state</span></a></li><li><a class="tocitem" href="#Linear-spin-wave-theory"><span>Linear spin wave theory</span></a></li><li><a class="tocitem" href="#What&#39;s-next?"><span>What&#39;s next?</span></a></li></ul></li><li><a class="tocitem" href="02_LSWT_CoRh2O4.html">2. Spin wave simulations of CoRh‚ÇÇO‚ÇÑ</a></li><li><a class="tocitem" href="03_LLD_CoRh2O4.html">3. Landau-Lifshitz dynamics of CoRh‚ÇÇO‚ÇÑ at finite <em>T</em></a></li><li><a class="tocitem" href="04_GSD_FeI2.html">4. Generalized spin dynamics of FeI‚ÇÇ at finite <em>T</em></a></li><li><a class="tocitem" href="05_MC_Ising.html">5. Monte Carlo sampling of the Ising model</a></li><li><a class="tocitem" href="06_CP2_Skyrmions.html">6. Dynamical quench into CP¬≤ skyrmion liquid</a></li><li><a class="tocitem" href="07_Dipole_Dipole.html">7. Long-range dipole interactions</a></li><li><a class="tocitem" href="08_Momentum_Conventions.html">8. Momentum transfer conventions</a></li><li><input class="collapse-toggle" id="menuitem-2-9" type="checkbox"/><label class="tocitem" for="menuitem-2-9"><span class="docs-label">SpinW tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="spinw/SW08_Kagome_AFM.html">SW8 - Kagome Antiferromagnet</a></li><li><a class="tocitem" href="spinw/SW15_Ba3NbFe3Si2O14.html">SW15 - Ba‚ÇÉNbFe‚ÇÉSi‚ÇÇO‚ÇÅ‚ÇÑ</a></li><li><a class="tocitem" href="spinw/SW18_Distorted_kagome.html">SW18 - Distorted kagome</a></li><li><a class="tocitem" href="spinw/SW19_Different_Ions.html">SW19 - Different magnetic ions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-10" type="checkbox"/><label class="tocitem" for="menuitem-2-10"><span class="docs-label">Contributed</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="contributed/MgCr2O4-tutorial.html">MgCr2O4 at Finite Temperature</a></li><li><a class="tocitem" href="contributed/kappa_tutorial.html">Enforcing the quantum sum rule with moment renormalization</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-11" type="checkbox"/><label class="tocitem" for="menuitem-2-11"><span class="docs-label">Advanced</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../parallelism.html">Parallelizing Calculations</a></li><li><a class="tocitem" href="../writevtk.html">ParaView Rendering</a></li></ul></li></ul></li><li><span class="tocitem">Modeling Guides</span><ul><li><a class="tocitem" href="../structure-factor.html">Structure Factor Calculations</a></li><li><a class="tocitem" href="../renormalization.html">Interaction Strength Renormalization</a></li></ul></li><li><a class="tocitem" href="../library.html">Library API</a></li><li><a class="tocitem" href="../versions.html">Version History</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href="01_LSWT_SU3_FeI2.html">1. Multi-flavor spin wave simulations of FeI‚ÇÇ (Showcase)</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="01_LSWT_SU3_FeI2.html">1. Multi-flavor spin wave simulations of FeI‚ÇÇ (Showcase)</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SunnySuite/Sunny.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ÔÇõ</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SunnySuite/Sunny.jl/blob/main/examples/01_LSWT_SU3_FeI2.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid">ÔÅÑ</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p>Download this example as <a href="../assets/notebooks/01_LSWT_SU3_FeI2.ipynb">Jupyter notebook</a> or <a href="../assets/scripts/01_LSWT_SU3_FeI2.jl">Julia script</a>.</p><h1 id="1.-Multi-flavor-spin-wave-simulations-of-FeI-(Showcase)"><a class="docs-heading-anchor" href="#1.-Multi-flavor-spin-wave-simulations-of-FeI-(Showcase)">1. Multi-flavor spin wave simulations of FeI‚ÇÇ (Showcase)</a><a id="1.-Multi-flavor-spin-wave-simulations-of-FeI-(Showcase)-1"></a><a class="docs-heading-anchor-permalink" href="#1.-Multi-flavor-spin-wave-simulations-of-FeI-(Showcase)" title="Permalink"></a></h1><p>FeI‚ÇÇ is an effective spin-1 material with strong single-ion anisotropy. Quadrupolar fluctuations give rise to a single-ion bound state that cannot be described by a dipole-only model. This tutorial illustrates how to use the linear spin wave theory of SU(3) coherent states (i.e. 2-flavor bosons) to model the magnetic behavior in FeI‚ÇÇ. The original study was performed in <a href="https://doi.org/10.1038/s41567-020-01110-1">Bai et al., Nature Physics 17, 467‚Äì472 (2021)</a>.</p><img src="https://raw.githubusercontent.com/SunnySuite/Sunny.jl/main/docs/src/assets/FeI2_crystal.jpg" style="float: left;" width="400"><p>The Fe atoms are arranged in stacked triangular layers. The effective spin Hamiltonian takes the form,</p><p class="math-container">\[\mathcal{H}=\sum_{(i,j)} ùêí_i ‚ãÖ J_{ij} ùêí_j - D\sum_i \left(S_i^z\right)^2,\]</p><p>where the set of exchange matrices <span>$J_{ij}$</span> between bonded sites <span>$(i,j)$</span> includes competing ferromagnetic and antiferromagnetic interactions. This model also includes a strong easy axis anisotropy, <span>$D &gt; 0$</span>.</p><p>We will formulate this Hamiltonian in Sunny and then calculate its dynamic structure factor.</p><h2 id="Get-Julia-and-Sunny"><a class="docs-heading-anchor" href="#Get-Julia-and-Sunny">Get Julia and Sunny</a><a id="Get-Julia-and-Sunny-1"></a><a class="docs-heading-anchor-permalink" href="#Get-Julia-and-Sunny" title="Permalink"></a></h2><p>Sunny is implemented in Julia. This is a relatively new programming language that allows for interactive development (like Python or Matlab) while also providing high numerical efficiency (like C++ or Fortran). New Julia users may wish to take a look at our <a href="https://github.com/SunnySuite/Sunny.jl/wiki/Getting-started-with-Julia">Getting Started with Julia</a> guide. Sunny requires Julia 1.9 or later.</p><p>From the Julia prompt, load <code>Sunny</code> and <code>GLMakie</code> for 3D graphics.</p><pre><code class="language-julia hljs">using Sunny, GLMakie</code></pre><p>If these packages are not yet installed, Julia should offer to install them using its built-in package management system. If old versions are installed, you may need to update them to run this tutorial.</p><h2 id="Crystals"><a class="docs-heading-anchor" href="#Crystals">Crystals</a><a id="Crystals-1"></a><a class="docs-heading-anchor-permalink" href="#Crystals" title="Permalink"></a></h2><p>A <a href="../library.html#Sunny.Crystal"><code>Crystal</code></a> describes the crystallographic unit cell and will usually be loaded from a <code>.cif</code> file. Here, we instead build a crystal by listing all atoms and their types.</p><pre><code class="language-julia hljs">a = b = 4.05012  # Lattice constants for triangular lattice
c = 6.75214      # Spacing in the z-direction

latvecs = lattice_vectors(a, b, c, 90, 90, 120) # A 3x3 matrix of lattice vectors that
                                                # define the conventional unit cell
positions = [[0, 0, 0], [1/3, 2/3, 1/4], [2/3, 1/3, 3/4]]  # Positions of atoms in fractions
                                                           # of lattice vectors
types = [&quot;Fe&quot;, &quot;I&quot;, &quot;I&quot;]
FeI2 = Crystal(latvecs, positions; types)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr4"><span class="sgr1">Crystal</span></span>
Spacegroup &#39;P -3 m 1&#39; (164)
Lattice params a=4.05, b=4.05, c=6.752, Œ±=90¬∞, Œ≤=90¬∞, Œ≥=120¬∞
Cell volume 95.92
Type &#39;Fe&#39;, Wyckoff 1a (point group &#39;-3m.&#39;):
   1. [0, 0, 0]
Type &#39;I&#39;, Wyckoff 2d (point group &#39;3m.&#39;):
   2. [1/3, 2/3, 1/4]
   3. [2/3, 1/3, 3/4]
</code></pre><p>Observe that Sunny inferred the space group, &#39;P -3 m 1&#39; (164) and labeled the atoms according to their point group symmetries.</p><p>Only the Fe atoms are magnetic, so we discard the I ions using <a href="../library.html#Sunny.subcrystal-Union{Tuple{N}, Tuple{Crystal, Vararg{String, N}}} where N"><code>subcrystal</code></a>.</p><pre><code class="language-julia hljs">cryst = subcrystal(FeI2, &quot;Fe&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr4"><span class="sgr1">Crystal</span></span>
Spacegroup &#39;P -3 m 1&#39; (164)
Lattice params a=4.05, b=4.05, c=6.752, Œ±=90¬∞, Œ≤=90¬∞, Œ≥=120¬∞
Cell volume 95.92
Type &#39;Fe&#39;, Wyckoff 1a (point group &#39;-3m.&#39;):
   1. [0, 0, 0]
</code></pre><p>Importantly, <code>cryst</code> retains the spacegroup symmetry of the full FeI‚ÇÇ crystal. This information will be used, for example, to propagate exchange interactions between symmetry-equivalent bonds.</p><p>In a running Julia environment, the crystal can be viewed interactively using <a href="../library.html#Sunny.view_crystal"><code>view_crystal</code></a>.</p><pre><code class="language-julia hljs">view_crystal(cryst)</code></pre><img src="01_LSWT_SU3_FeI2-7cad0c4d.png" alt="Example block output"/><h2 id="Symmetry-analysis"><a class="docs-heading-anchor" href="#Symmetry-analysis">Symmetry analysis</a><a id="Symmetry-analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Symmetry-analysis" title="Permalink"></a></h2><p>The command <a href="../library.html#Sunny.print_symmetry_table-Tuple{Crystal, Any}"><code>print_symmetry_table</code></a> provides a list of all the symmetry-allowed interactions up to a cutoff distance.</p><pre><code class="language-julia hljs">print_symmetry_table(cryst, 8.0)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Atom 1
Type &#39;Fe&#39;, position [0, 0, 0], multiplicity 1
Allowed g-tensor: [A 0 0
                   0 A 0
                   0 0 B]
Allowed anisotropy in Stevens operators:
    c‚ÇÅ*ùí™[2,0] +
    c‚ÇÇ*ùí™[4,-3] + c‚ÇÉ*ùí™[4,0] +
    c‚ÇÑ*ùí™[6,-3] + c‚ÇÖ*ùí™[6,0] + c‚ÇÜ*ùí™[6,6]

Bond(1, 1, [1, 0, 0])
Distance 4.05012, coordination 6
Connects &#39;Fe&#39; at [0, 0, 0] to &#39;Fe&#39; at [1, 0, 0]
Allowed exchange matrix: [A 0 0
                          0 B D
                          0 D C]

Bond(1, 1, [0, 0, 1])
Distance 6.75214, coordination 2
Connects &#39;Fe&#39; at [0, 0, 0] to &#39;Fe&#39; at [0, 0, 1]
Allowed exchange matrix: [A 0 0
                          0 A 0
                          0 0 B]

Bond(1, 1, [1, 2, 0])
Distance 7.0150136167509, coordination 6
Connects &#39;Fe&#39; at [0, 0, 0] to &#39;Fe&#39; at [1, 2, 0]
Allowed exchange matrix: [A 0 0
                          0 B D
                          0 D C]

Bond(1, 1, [1, 0, 1])
Distance 7.8736818956572, coordination 12
Connects &#39;Fe&#39; at [0, 0, 0] to &#39;Fe&#39; at [1, 0, 1]
Allowed exchange matrix: [A F E
                          F B D
                          E D C]</code></pre><p>The allowed <span>$g$</span>-tensor is expressed as a 3√ó3 matrix in the free coefficients <code>A</code>, <code>B</code>, ... The allowed single-ion anisotropy is expressed as a linear combination of Stevens operators. The latter correspond to polynomials of the spin operators, as we will describe below.</p><p>The allowed exchange interactions are given as a 3√ó3 matrix for representative bonds. The notation <code>Bond(i, j, n)</code> indicates a bond between atom indices <code>i</code> and <code>j</code>, with cell offset <code>n</code>. In the general case, it will be necessary to associate atom indices with their positions in the unit cell; these can be viewed with <code>display(cryst)</code>. Note that the order of the pair <span>$(i, j)$</span> is significant if the exchange tensor contains antisymmetric Dzyaloshinskii‚ÄìMoriya (DM) interactions.</p><p>In the case of FeI‚ÇÇ, <code>Bond(1, 1, [1,0,0])</code> is one of the 6 nearest-neighbor Fe-Fe bonds on a triangular lattice layer, and <code>Bond(1, 1, [0,0,1])</code> is an Fe-Fe bond between layers.</p><h2 id="Building-a-spin-System"><a class="docs-heading-anchor" href="#Building-a-spin-System">Building a spin System</a><a id="Building-a-spin-System-1"></a><a class="docs-heading-anchor-permalink" href="#Building-a-spin-System" title="Permalink"></a></h2><p>In constructing a spin <a href="../library.html#Sunny.System-Tuple{Crystal, Tuple{Int64, Int64, Int64}, Vector{SpinInfo}, Symbol}"><code>System</code></a>, we must provide several additional details about the spins.</p><pre><code class="language-julia hljs">sys = System(cryst, (4, 4, 4), [SpinInfo(1, S=1, g=2)], :SUN, seed=2)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr4"><span class="sgr1">System [SU(3)]</span></span>
Lattice (4√ó4√ó4)√ó1
Energy per site 0
</code></pre><p>This system includes <span>$4√ó4√ó4$</span> unit cells, i.e. 64 Fe atoms, each with spin <span>$S=1$</span> and a <span>$g$</span>-factor of 2. Quantum mechanically, spin <span>$S=1$</span> involves a superposition of <span>$2S+1=3$</span> distinct angular momentum states. In <code>:SUN</code> mode, this superposition will be modeled explicitly using the formalism of SU(3) coherent states, which captures both dipolar and quadrupolar fluctuations. For the more traditional dipole dynamics, use <code>:dipole</code> mode instead.</p><p>Next we will use <a href="../library.html#Sunny.set_exchange!-Union{Tuple{N}, Tuple{System{N}, Any, Bond}} where N"><code>set_exchange!</code></a> to assign interaction to bonds. Sunny will automatically propagate each interaction to all symmetry-equivalent bonds in the unit cell. The FeI‚ÇÇ interactions below follow <a href="https://doi.org/10.1038/s41567-020-01110-1">Bai et al</a>.</p><pre><code class="language-julia hljs">J1pm   = -0.236
J1pmpm = -0.161
J1zpm  = -0.261
J2pm   = 0.026
J3pm   = 0.166
J‚Ä≤0pm  = 0.037
J‚Ä≤1pm  = 0.013
J‚Ä≤2apm = 0.068

J1zz   = -0.236
J2zz   = 0.113
J3zz   = 0.211
J‚Ä≤0zz  = -0.036
J‚Ä≤1zz  = 0.051
J‚Ä≤2azz = 0.073

J1xx = J1pm + J1pmpm
J1yy = J1pm - J1pmpm
J1yz = J1zpm

set_exchange!(sys, [J1xx   0.0    0.0;
                    0.0    J1yy   J1yz;
                    0.0    J1yz   J1zz], Bond(1,1,[1,0,0]))
set_exchange!(sys, [J2pm   0.0    0.0;
                    0.0    J2pm   0.0;
                    0.0    0.0    J2zz], Bond(1,1,[1,2,0]))
set_exchange!(sys, [J3pm   0.0    0.0;
                    0.0    J3pm   0.0;
                    0.0    0.0    J3zz], Bond(1,1,[2,0,0]))
set_exchange!(sys, [J‚Ä≤0pm  0.0    0.0;
                    0.0    J‚Ä≤0pm  0.0;
                    0.0    0.0    J‚Ä≤0zz], Bond(1,1,[0,0,1]))
set_exchange!(sys, [J‚Ä≤1pm  0.0    0.0;
                    0.0    J‚Ä≤1pm  0.0;
                    0.0    0.0    J‚Ä≤1zz], Bond(1,1,[1,0,1]))
set_exchange!(sys, [J‚Ä≤2apm 0.0    0.0;
                    0.0    J‚Ä≤2apm 0.0;
                    0.0    0.0    J‚Ä≤2azz], Bond(1,1,[1,2,1]))</code></pre><p>The function <a href="../library.html#Sunny.set_onsite_coupling!-Tuple{System, Any, Int64}"><code>set_onsite_coupling!</code></a> assigns a single-ion anisotropy. The argument can be constructed using <a href="../library.html#Sunny.spin_matrices-Tuple{Any}"><code>spin_matrices</code></a> or <a href="../library.html#Sunny.stevens_matrices-Tuple{Any}"><code>stevens_matrices</code></a>. Here we use Julia&#39;s anonymous function syntax to assign an easy-axis anisotropy along the direction <span>$\hat{z}$</span>.</p><pre><code class="language-julia hljs">D = 2.165
set_onsite_coupling!(sys, S -&gt; -D*S[3]^2, 1)</code></pre><h1 id="Calculating-structure-factor-intensities"><a class="docs-heading-anchor" href="#Calculating-structure-factor-intensities">Calculating structure factor intensities</a><a id="Calculating-structure-factor-intensities-1"></a><a class="docs-heading-anchor-permalink" href="#Calculating-structure-factor-intensities" title="Permalink"></a></h1><p>In the remainder of this tutorial, we will examine Sunny&#39;s tools for calculating the dynamical structure factor using a <a href="https://arxiv.org/abs/1307.7731">multi-boson generalization</a> of linear spin wave theory (LSWT). This theory describes non-interacting quasi-particle excitations that hybridize dipolar and quadrupolar modes.</p><h2 id="Finding-the-ground-state"><a class="docs-heading-anchor" href="#Finding-the-ground-state">Finding the ground state</a><a id="Finding-the-ground-state-1"></a><a class="docs-heading-anchor-permalink" href="#Finding-the-ground-state" title="Permalink"></a></h2><p>Begin with a random configuration and use <a href="../library.html#Sunny.minimize_energy!-Union{Tuple{System{N}}, Tuple{N}} where N"><code>minimize_energy!</code></a> to find a configuration of the SU(3) coherent states (i.e. spin dipoles and quadrupoles) that locally minimizes energy.</p><pre><code class="language-julia hljs">randomize_spins!(sys)
minimize_energy!(sys)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">59</code></pre><p>A positive number above indicates that the procedure has converged to a local energy minimum. The configuration, however, may still have defects. This can be checked by visualizing the spins, colored according to their <span>$z$</span>-components.</p><pre><code class="language-julia hljs">plot_spins(sys; color=[s[3] for s in sys.dipoles])</code></pre><img src="01_LSWT_SU3_FeI2-33c94cf5.png" alt="Example block output"/><p>A different understanding of the magnetic ordering can be obtained by moving to Fourier space. The &#39;instant&#39; structure factor <span>$ùíÆ(ùê™)$</span> is an experimental observable. To investigate <span>$ùíÆ(ùê™)$</span> as true 3D data, Sunny provides <a href="../library.html#Sunny.instant_correlations-Tuple{System}"><code>instant_correlations</code></a> and related functions. Here, however, we will use <a href="../library.html#Sunny.print_wrapped_intensities-Union{Tuple{System{N}}, Tuple{N}} where N"><code>print_wrapped_intensities</code></a>, which gives average intensities for the individual Bravais sublattices (in effect, all wavevectors are wrapped to the first Brillouin zone).</p><pre><code class="language-julia hljs">print_wrapped_intensities(sys)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dominant wavevectors for spin sublattices:

    [-1/4, 1/4, 1/4]       37.33% weight
    [1/4, -1/4, -1/4]      37.33%
    [-1/4, 1/4, 0]          1.60%
    [1/4, -1/4, 0]          1.60%
    [-1/4, 1/4, 1/2]        1.60%
    [1/4, -1/4, 1/2]        1.60%
    [1/4, -1/4, 1/4]        1.59%
    [-1/4, 1/4, -1/4]       1.59%
    [1/4, 0, 1/4]           0.77%
    [-1/4, 0, -1/4]         0.77%
    [0, -1/4, 1/4]          0.77%
    ...                     ...</code></pre><p>The result will likely be approximately consistent with the known zero-field energy-minimizing magnetic structure of FeI‚ÇÇ, which is single-<span>$Q$</span> (two-up, two-down antiferromagnetic order). Mathematically, spontaneous symmetry breaking should select one of <span>$¬±Q = [0, -1/4, 1/4]$</span>, <span>$[1/4, 0, 1/4]$</span>, or <span>$[-1/4,1/4,1/4]$</span>, associated with the three-fold rotational symmetry of the crystal spacegroup. In nature, however, one will frequently encounter competing &quot;domains&quot; associated with the three possible orientations of the ground state.</p><p>If the desired ground state is already known, as with FeI‚ÇÇ, it could be entered by hand using <a href="../library.html#Sunny.set_dipole!-Union{Tuple{N}, Tuple{System{N}, Any, Any}} where N"><code>set_dipole!</code></a>. Alternatively, in the case of FeI‚ÇÇ, we could repeatedly employ the above randomization and minimization procedure until a defect-free configuration is found. Some systems will have more complicated ground states, which can be much more challenging to find. For this, Sunny provides experimental support for powerful simulated annealing via <a href="https://en.wikipedia.org/wiki/Parallel_tempering">parallel tempering</a>, but that is outside the scope of this tutorial.</p><p>Here, let&#39;s break the three-fold symmetry of FeI‚ÇÇ by hand. Given one or more desired <span>$Q$</span> modes, Sunny can suggest a magnetic supercell with appropriate periodicity. Let&#39;s arbitrarily select one of the three possible ordering wavevectors, <span>$Q = [0, -1/4, 1/4]$</span>. Sunny suggests a corresponding magnetic supercell in units of the crystal lattice vectors.</p><pre><code class="language-julia hljs">suggest_magnetic_supercell([[0, -1/4, 1/4]])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Possible magnetic supercell in multiples of lattice vectors:

    [1 0 0; 0 2 1; 0 -2 1]

for the rationalized wavevectors:

    [[0, -1/4, 1/4]]</code></pre><p>The system returned by <a href="../library.html#Sunny.reshape_supercell-Union{Tuple{N}, Tuple{System{N}, Any}} where N"><code>reshape_supercell</code></a> is smaller, and is sheared relative to the original system. This makes it much easier to find the global energy minimum.</p><pre><code class="language-julia hljs">sys_min = reshape_supercell(sys, [1 0 0; 0 2 1; 0 -2 1])
randomize_spins!(sys_min)
minimize_energy!(sys_min);</code></pre><p>Plot the system again, now including &quot;ghost&quot; spins out to 12‚Ñ´</p><pre><code class="language-julia hljs">plot_spins(sys_min; color=[s[3] for s in sys_min.dipoles], ghost_radius=12)</code></pre><img src="01_LSWT_SU3_FeI2-61e48903.png" alt="Example block output"/><h2 id="Linear-spin-wave-theory"><a class="docs-heading-anchor" href="#Linear-spin-wave-theory">Linear spin wave theory</a><a id="Linear-spin-wave-theory-1"></a><a class="docs-heading-anchor-permalink" href="#Linear-spin-wave-theory" title="Permalink"></a></h2><p>Now that we have found the ground state for a magnetic supercell, we can immediately proceed to perform zero-temperature calculations using linear spin wave theory. We begin by instantiating a <code>SpinWaveTheory</code> type using the supercell.</p><pre><code class="language-julia hljs">swt = SpinWaveTheory(sys_min)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr4"><span class="sgr1">SpinWaveTheory</span></span>
Atoms in magnetic supercell: 4
‚ïî ‚¨§ ‚¨§ ‚¨§ Sx
‚ïë ‚ãÖ ‚¨§ ‚¨§ Sy
‚ïö ‚ãÖ ‚ãÖ ‚¨§ Sz
</code></pre><p>Select a sequence of wavevectors that will define a piecewise linear interpolation in reciprocal lattice units (RLU).</p><pre><code class="language-julia hljs">q_points = [[0,0,0], [1,0,0], [0,1,0], [1/2,0,0], [0,1,0], [0,0,0]];</code></pre><p>The function <a href="../library.html#Sunny.reciprocal_space_path-Tuple{Crystal, Any, Any}"><code>reciprocal_space_path</code></a> will linearly sample a <code>path</code> between the provided <span>$q$</span>-points with a given <code>density</code>. The <code>xticks</code> return value provides labels for use in plotting.</p><pre><code class="language-julia hljs">density = 50
path, xticks = reciprocal_space_path(cryst, q_points, density);</code></pre><p>The <a href="../library.html#Sunny.dispersion-Tuple{SpinWaveTheory, Any}"><code>dispersion</code></a> function defines the quasiparticle excitation energies <span>$œâ_i(ùê™)$</span> for each point <span>$ùê™$</span> along the reciprocal space path.</p><pre><code class="language-julia hljs">disp = dispersion(swt, path);</code></pre><p>In addition to the band energies <span>$œâ_i(ùê™)$</span>, Sunny can calculate the inelastic neutron scattering intensity <span>$I_i(ùê™)$</span> for each band <span>$i$</span> according to an <a href="../library.html#Sunny.intensity_formula-Tuple{Function, Any, Any}"><code>intensity_formula</code></a>. We choose to apply a polarization correction <span>$(1 - ùê™‚äóùê™)$</span> by setting the mode argument to <code>:perp</code>. Selecting <code>delta_function_kernel</code> specifies that we want the energy and intensity of each band individually.</p><pre><code class="language-julia hljs">formula = intensity_formula(swt, :perp; kernel=delta_function_kernel)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr4"><span class="sgr1">Quantum Scattering Intensity Formula</span></span>
At any Q and for each band œâ·µ¢ = Œµ·µ¢(Q), with S = S(Q,œâ·µ¢):

  Intensity(Q,œâ) = ‚àë·µ¢ Œ¥(œâ-œâ·µ¢) ‚àë_ij (I - Q‚äóQ){i,j} S{i,j}
                              
                              (i,j = Sx,Sy,Sz)

BandStructure information (œâ·µ¢ and intensity) reported for each band
</code></pre><p>The function <a href="../library.html#Sunny.intensities_bands-Tuple{SpinWaveTheory, Any, Sunny.SpinWaveIntensityFormula}"><code>intensities_bands</code></a> uses linear spin wave theory to calculate both the dispersion and intensity data for the provided path.</p><pre><code class="language-julia hljs">disp, intensity = intensities_bands(swt, path, formula);</code></pre><p>These can be plotted in GLMakie.</p><pre><code class="language-julia hljs">fig = Figure()
ax = Axis(fig[1,1]; xlabel=&quot;Momentum (r.l.u.)&quot;, ylabel=&quot;Energy (meV)&quot;, xticks, xticklabelrotation=œÄ/6)
ylims!(ax, 0.0, 7.5)
xlims!(ax, 1, size(disp, 1))
colorrange = extrema(intensity)
for i in axes(disp, 2)
    lines!(ax, 1:length(disp[:,i]), disp[:,i]; color=intensity[:,i], colorrange)
end
fig</code></pre><img src="01_LSWT_SU3_FeI2-4eac3a20.png" alt="Example block output"/><p>To make comparisons with inelastic neutron scattering (INS) data, it is helpful to employ an empirical broadening kernel, e.g., a <a href="../library.html#Sunny.lorentzian-Tuple{}"><code>lorentzian</code></a>.</p><pre><code class="language-julia hljs">fwhm = 0.3 # full width at half maximum (meV)
broadened_formula = intensity_formula(swt, :perp; kernel=lorentzian(; fwhm))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr4"><span class="sgr1">Quantum Scattering Intensity Formula</span></span>
At any (Q,œâ), with S = S(Q,œâ·µ¢):

  Intensity(Q,œâ) = ‚àë·µ¢ Kernel(œâ-œâ·µ¢) ‚àë_ij (I - Q‚äóQ){i,j} S{i,j}
                                   
                                   (i,j = Sx,Sy,Sz)

Intensity(œâ) reported
</code></pre><p>The <a href="../library.html#Sunny.intensities_broadened-Tuple{SpinWaveTheory, Any, Any, Any}"><code>intensities_broadened</code></a> function requires an energy range in addition to the <span>$ùê™$</span>-space path.</p><pre><code class="language-julia hljs">energies = collect(0:0.01:10)  # 0 &lt; œâ &lt; 10 (meV).
is1 = intensities_broadened(swt, path, energies, broadened_formula);</code></pre><p>A real FeI‚ÇÇ sample will exhibit competing magnetic domains associated with spontaneous symmetry breaking of the 6-fold rotational symmetry of the triangular lattice. Note that the wavevectors <span>$ùê™$</span> and <span>$-ùê™$</span> are equivalent in the structure factor, which leaves three distinct domain orientations, which are related by 120¬∞ rotations about the <span>$zÃÇ$</span>-axis. Rather than rotating the spin configuration directly, on can rotate the <span>$ùê™$</span>-space path. Below, we use <a href="../library.html#Sunny.rotation_in_rlu-Tuple{Crystal, Any, Any}"><code>rotation_in_rlu</code></a> to average the intensities over all three possible orientations.</p><pre><code class="language-julia hljs">R = rotation_in_rlu(cryst, [0, 0, 1], 2œÄ/3)
is2 = intensities_broadened(swt, [R*q for q in path], energies, broadened_formula)
is3 = intensities_broadened(swt, [R*R*q for q in path], energies, broadened_formula)
is_averaged = (is1 + is2 + is3) / 3

fig = Figure()
ax = Axis(fig[1,1]; xlabel=&quot;Momentum (r.l.u.)&quot;, ylabel=&quot;Energy (meV)&quot;, xticks, xticklabelrotation=œÄ/6)
heatmap!(ax, 1:size(is_averaged, 1), energies, is_averaged)
fig</code></pre><img src="01_LSWT_SU3_FeI2-c4f27b27.png" alt="Example block output"/><p>This result can be directly compared to experimental neutron scattering data from <a href="https://doi.org/10.1038/s41567-020-01110-1">Bai et al.</a></p><img src="https://raw.githubusercontent.com/SunnySuite/Sunny.jl/main/docs/src/assets/FeI2_intensity.jpg"><p>(The publication figure accidentally used a non-standard coordinate system to label the wave vectors.)</p><p>To get this agreement, the use of SU(3) coherent states is essential. In other words, we needed a theory of multi-flavored bosons. The lower band has large quadrupolar character, and arises from the strong easy-axis anisotropy of FeI‚ÇÇ. By setting <code>mode = :SUN</code>, the calculation captures this coupled dipole-quadrupole dynamics.</p><p>An interesting exercise is to repeat the same study, but using <code>mode = :dipole</code> instead of <code>:SUN</code>. That alternative choice would constrain the coherent state dynamics to the space of dipoles only.</p><p>The full dynamical spin structure factor (DSSF) can be retrieved as a <span>$3√ó3$</span> matrix with the <a href="../library.html#Sunny.dssf-Tuple{SpinWaveTheory, Any}"><code>dssf</code></a> function, for a given path of <span>$ùê™$</span>-vectors.</p><pre><code class="language-julia hljs">disp, is = dssf(swt, path);</code></pre><p>The first output <code>disp</code> is identical to that obtained from <code>dispersion</code>. The second output <code>is</code> contains a list of <span>$3√ó3$</span> matrix of intensities. For example, <code>is[q,n][2,3]</code> yields the <span>$(yÃÇ,zÃÇ)$</span> component of the structure factor intensity for <code>nth</code> mode at the <code>q</code>th wavevector in the <code>path</code>.</p><h2 id="What&#39;s-next?"><a class="docs-heading-anchor" href="#What&#39;s-next?">What&#39;s next?</a><a id="What&#39;s-next?-1"></a><a class="docs-heading-anchor-permalink" href="#What&#39;s-next?" title="Permalink"></a></h2><p>The multi-boson linear spin wave theory, applied above, can be understood as the quantization of a certain generalization of the Landau-Lifshitz spin dynamics. Rather than dipoles, this dynamics takes places on the space of <a href="https://arxiv.org/abs/2106.14125">SU(<em>N</em>) coherent states</a>.</p><p>The full SU(<em>N</em>) coherent state dynamics, with appropriate quantum correction factors, can be useful to model finite temperature scattering data. In particular, it captures certain anharmonic effects due to thermal fluctuations. See our <a href="04_GSD_FeI2.html#4.-Generalized-spin-dynamics-of-FeI-at-finite-*T*">generalized spin dynamics tutorial</a>.</p><p>The classical dynamics is also a good starting point to study non-equilibrium phenomena. Empirical noise and damping terms can be used to model <a href="https://arxiv.org/abs/2209.01265">coupling to a thermal bath</a>. This yields a Langevin dynamics of SU(<em>N</em>) coherent states. Our <a href="06_CP2_Skyrmions.html#6.-Dynamical-quench-into-CP-skyrmion-liquid">dynamical SU(<em>N</em>) quench</a> tutorial illustrates how a temperature quench can give rise to novel liquid phase of CP¬≤ skyrmions.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../index.html">¬´ Overview</a><a class="docs-footer-nextpage" href="02_LSWT_CoRh2O4.html">2. Spin wave simulations of CoRh‚ÇÇO‚ÇÑ ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Tuesday 18 June 2024 23:16">Tuesday 18 June 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
