<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Structure Factor Conventions · Documentation</title><meta name="title" content="Structure Factor Conventions · Documentation"/><meta property="og:title" content="Structure Factor Conventions · Documentation"/><meta property="twitter:title" content="Structure Factor Conventions · Documentation"/><meta name="description" content="Documentation for Documentation."/><meta property="og:description" content="Documentation for Documentation."/><meta property="twitter:description" content="Documentation for Documentation."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="index.html"><img class="docs-light-only" src="assets/logo.svg" alt="Documentation logo"/><img class="docs-dark-only" src="assets/logo-dark.svg" alt="Documentation logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">Documentation</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">Welcome</a></li><li><a class="tocitem" href="why.html">Why Choose Sunny?</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="examples/01_LSWT_CoRh2O4.html">1. Spin wave simulations of CoRh₂O₄</a></li><li><a class="tocitem" href="examples/02_LLD_CoRh2O4.html">2. Landau-Lifshitz dynamics of CoRh₂O₄ at finite <em>T</em></a></li><li><a class="tocitem" href="examples/03_LSWT_SU3_FeI2.html">3. Multi-flavor spin wave simulations of FeI₂</a></li><li><a class="tocitem" href="examples/04_GSD_FeI2.html">4. Generalized spin dynamics of FeI₂ at finite <em>T</em></a></li><li><a class="tocitem" href="examples/05_MC_Ising.html">5. Monte Carlo sampling of the Ising model</a></li><li><a class="tocitem" href="examples/06_CP2_Skyrmions.html">6. Dynamical quench into CP² skyrmion liquid</a></li><li><a class="tocitem" href="examples/07_Dipole_Dipole.html">7. Long-range dipole interactions</a></li><li><a class="tocitem" href="examples/08_Momentum_Conventions.html">8. Momentum transfer conventions</a></li><li><a class="tocitem" href="examples/09_Disorder_KPM.html">9. Disordered system with KPM</a></li><li><input class="collapse-toggle" id="menuitem-3-10" type="checkbox"/><label class="tocitem" for="menuitem-3-10"><span class="docs-label">SpinW ports</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="examples/spinw/SW01_FM_Heseinberg_chain.html">SW01 - FM Heisenberg chain</a></li><li><a class="tocitem" href="examples/spinw/SW02_AFM_Heisenberg_chain.html">SW02 - AFM Heisenberg chain</a></li><li><a class="tocitem" href="examples/spinw/SW03_Frustrated_chain.html">SW03 - Frustrated J1-J2 chain</a></li><li><a class="tocitem" href="examples/spinw/SW04_Frustrated_square.html">SW04 - Frustrated square lattice</a></li><li><a class="tocitem" href="examples/spinw/SW05_Simple_kagome_FM.html">SW05 - Simple kagome ferromagnet</a></li><li><a class="tocitem" href="examples/spinw/SW06_Complex_kagome_FM.html">SW06 - Complex kagome ferromagnet</a></li><li><a class="tocitem" href="examples/spinw/SW07_k0_kagome_AFM.html">SW07 - k=0 kagome antiferromagnet</a></li><li><a class="tocitem" href="examples/spinw/SW08_sqrt3_kagome_AFM.html">SW08 - √3×√3 kagome antiferromagnet</a></li><li><a class="tocitem" href="examples/spinw/SW09_k0_kagome_AFM_DM.html">SW09 - k=0 kagome AFM and DM</a></li><li><a class="tocitem" href="examples/spinw/SW10_Energy_cut.html">SW10 - Energy cut on square lattice</a></li><li><a class="tocitem" href="examples/spinw/SW11_La2CuO4.html">SW11 - La₂CuO₄</a></li><li><a class="tocitem" href="examples/spinw/SW12_Triangular_easy_plane.html">SW12 - Triangular lattice with easy plane</a></li><li><a class="tocitem" href="examples/spinw/SW13_LiNiPO4.html">SW13 - LiNiPO₄</a></li><li><a class="tocitem" href="examples/spinw/SW14_YVO3.html">SW14 - YVO₃</a></li><li><a class="tocitem" href="examples/spinw/SW15_Ba3NbFe3Si2O14.html">SW15 - Ba₃NbFe₃Si₂O₁₄</a></li><li><a class="tocitem" href="examples/spinw/SW18_Distorted_kagome.html">SW18 - Distorted kagome</a></li><li><a class="tocitem" href="examples/spinw/SW19_Different_Ions.html">SW19 - Different magnetic ions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-11" type="checkbox"/><label class="tocitem" for="menuitem-3-11"><span class="docs-label">Contributed</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="examples/contributed/MgCr2O4-tutorial.html">MgCr2O4 at Finite Temperature</a></li><li><a class="tocitem" href="examples/contributed/kappa_tutorial.html">Enforcing the quantum sum rule with moment renormalization</a></li></ul></li></ul></li><li><a class="tocitem" href="library.html">Library Reference</a></li><li><span class="tocitem">Notes and Details</span><ul><li class="is-active"><a class="tocitem" href="structure-factor.html">Structure Factor Conventions</a><ul class="internal"><li><a class="tocitem" href="#Dynamical-correlations"><span>Dynamical correlations</span></a></li><li><a class="tocitem" href="#Lehmann-representation-in-frequency-space"><span>Lehmann representation in frequency space</span></a></li><li><a class="tocitem" href="#Discrete-sums-on-the-lattice"><span>Discrete sums on the lattice</span></a></li><li><a class="tocitem" href="#Quantum-sum-rule"><span>Quantum sum rule</span></a></li><li><a class="tocitem" href="#Neutron-scattering-cross-section"><span>Neutron scattering cross section</span></a></li><li><a class="tocitem" href="#Conventions-for-the-Sunny-calculated-structure-factor"><span>Conventions for the Sunny-calculated structure factor</span></a></li><li><a class="tocitem" href="#Calculations-with-spin-wave-theory"><span>Calculations with spin wave theory</span></a></li><li><a class="tocitem" href="#Calculations-with-classical-spin-dynamics"><span>Calculations with classical spin dynamics</span></a></li></ul></li><li><a class="tocitem" href="renormalization.html">Interaction Renormalization</a></li><li><a class="tocitem" href="parallelism.html">Parallelizing Calculations</a></li></ul></li><li><a class="tocitem" href="versions.html">Version History</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Notes and Details</a></li><li class="is-active"><a href="structure-factor.html">Structure Factor Conventions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="structure-factor.html">Structure Factor Conventions</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SunnySuite/Sunny.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SunnySuite/Sunny.jl/blob/main/docs/src/structure-factor.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Structure-Factor-Conventions"><a class="docs-heading-anchor" href="#Structure-Factor-Conventions">Structure Factor Conventions</a><a id="Structure-Factor-Conventions-1"></a><a class="docs-heading-anchor-permalink" href="#Structure-Factor-Conventions" title="Permalink"></a></h1><h2 id="Dynamical-correlations"><a class="docs-heading-anchor" href="#Dynamical-correlations">Dynamical correlations</a><a id="Dynamical-correlations-1"></a><a class="docs-heading-anchor-permalink" href="#Dynamical-correlations" title="Permalink"></a></h2><p>Dynamical correlations are a fundamental observable in condensed matter systems, and facilitate comparison between theory and experimental data.</p><p>Frequently, spin-spin correlations are of interest. More generally, one may consider correlations between arbitrary operator fields <span>$\hat{A}$</span> and <span>$\hat{B}$</span>. In the Heisenberg picture, operators evolve in time. Consider the dynamical correlation as an equilibrium expectation value,</p><p class="math-container">\[\begin{equation}
C(𝐫, t) = \int_V ⟨\hat{B}^†(𝐫₀, 0) \hat{A}(𝐫₀ + 𝐫, t)⟩ d𝐫₀,
\end{equation}\]</p><p>where the integral runs over some macroscopic volume <span>$V → ∞$</span>. By construction, <span>$C(𝐫, t)$</span> is an extensive quantity. Ignoring surface effects, the correlation becomes an ordinary product in momentum-space,</p><p class="math-container">\[\begin{equation}
C(𝐪, t) = ⟨\hat{B}_𝐪^†(0) \hat{A}_𝐪(t)⟩.
\end{equation}\]</p><p>Our convention for the Fourier transform from position <span>$𝐫$</span> to momentum <span>$𝐪$</span> is,</p><p class="math-container">\[\begin{equation}
\hat{A}_𝐪 ≡ \int_V e^{+ i 𝐪⋅𝐫} \hat{A}(𝐫) d𝐫.
\end{equation}\]</p><p>For a Hermitian operator <span>$\hat{A}^†(𝐫) = \hat{A}(𝐫)$</span>, it follows that <span>$\hat{A}_𝐪^† ≡ (\hat{A}_𝐪)^† = \hat{A}_{-𝐪}$</span> in momentum space. </p><h2 id="Lehmann-representation-in-frequency-space"><a class="docs-heading-anchor" href="#Lehmann-representation-in-frequency-space">Lehmann representation in frequency space</a><a id="Lehmann-representation-in-frequency-space-1"></a><a class="docs-heading-anchor-permalink" href="#Lehmann-representation-in-frequency-space" title="Permalink"></a></h2><p>Dynamical correlations are most conveniently calculated in frequency space. We use the convention,</p><p class="math-container">\[\begin{equation}
C(𝐪, ω) ≡ \frac{1}{2π} \int_{-∞}^{∞} e^{-iωt} C(𝐪, t) dt.
\end{equation}\]</p><p>On the right-hand side, substitute the definition of Heisenberg time evolution,</p><p class="math-container">\[\begin{equation}
\hat{A}(t) ≡ e^{i t \hat{H}} \hat{A} e^{-i t \hat{H}},
\end{equation}\]</p><p>and the definition of the thermal average,</p><p class="math-container">\[\begin{equation}
⟨\hat{O}⟩ ≡ \frac{1}{\mathcal{Z}}\mathrm{tr}\, e^{-β \hat{H}} \hat{O}, \quad \mathcal{Z} ≡ \mathrm{tr}\, e^{-β \hat{H}}.
\end{equation}\]</p><p>Let <span>$ϵ_μ$</span> and <span>$|μ⟩$</span> denote the exact eigenvalues and eigenstates of the full Hamiltonian <span>$\hat{H}$</span>. The eigenstates comprise a complete, orthonormal basis. The operator trace can be evaluated as a sum over eigenbasis states <span>$|ν⟩$</span>. Insert a resolution of the identity, <span>$|μ⟩⟨μ| = 1$</span>, with implicit summation on the repeated <span>$μ$</span> index. Then, collecting results and applying,</p><p class="math-container">\[\begin{equation}
\int_{-∞}^{∞} e^{-iωt} dt = 2πδ(ω),
\end{equation}\]</p><p>the result is the Lehmann representation of dynamical correlations,</p><p class="math-container">\[\begin{equation}
C(𝐪,ω) = \frac{1}{\mathcal{Z}} e^{-β ϵ_ν} δ(ϵ_μ - ϵ_ν - ω) ⟨ν|\hat{B}^†_𝐪|μ⟩⟨μ|\hat{A}_𝐪 |ν⟩,
\end{equation}\]</p><p>with implicit summation over eigenbasis indices <span>$μ$</span> and <span>$ν$</span>. This representation is the usual starting point for quantum calculations such as linear spin wave theory and its various generalizations.</p><p>Using the Lehmann representation, it can be shown that positive and negative frequencies are linked through a detailed balance condition,</p><p class="math-container">\[\begin{equation}
C_{⟨BA^†⟩}(𝐪,-ω) = e^{-β ω}  C_{⟨B^†A⟩}(𝐪, ω)^*.
\end{equation}\]</p><p>This subscript notation indicates that the left-hand side is a correlation of Hermitian-conjugated operators. Typically <span>$\hat{A}$</span> and <span>$\hat{B}$</span> will be Hermitian in real-space, and then detailed balance becomes <span>$C(-𝐪,-ω) = e^{-β ω} C(𝐪, ω)^*$</span>.</p><h2 id="Discrete-sums-on-the-lattice"><a class="docs-heading-anchor" href="#Discrete-sums-on-the-lattice">Discrete sums on the lattice</a><a id="Discrete-sums-on-the-lattice-1"></a><a class="docs-heading-anchor-permalink" href="#Discrete-sums-on-the-lattice" title="Permalink"></a></h2><p>A chemical (crystallographic) unit cell is associated with three lattice vectors <span>$𝐚_{\{1,2,3\}}$</span>. Site positions are</p><p class="math-container">\[\begin{equation}
𝐫_{𝐦,j} ≡ m_1 𝐚_1 + m_2 𝐚_2 + m_3 𝐚_3 + δ𝐫_j,
\end{equation}\]</p><p>for integers <span>$𝐦 = \{m_1, m_2, m_3\}$</span>. If the crystal is decorated, then <span>$δ𝐫_j$</span> denotes the relative displacement of the Bravais sublattice <span>$j$</span>. </p><p>Let <span>$\hat{A}(𝐫)$</span> be decomposed into discrete contributions <span>$\hat{A}_{𝐦,j} δ(𝐫-𝐫_{𝐦,j})$</span> at each lattice point <span>$𝐫_{𝐦,j}$</span>. The Fourier transform becomes a discrete sum,</p><p class="math-container">\[\begin{equation}
\hat{A}_𝐪 = \sum_j \sum_𝐦 e^{i 𝐪⋅𝐫_{𝐦,j}} \hat{A}_{𝐦,j} ≡ \sum_j \hat{A}_{𝐪,j}.
\end{equation}\]</p><p>The second equality above introduces <span>$\hat{A}_{𝐪,j}$</span> as the Fourier transform of <span>$\hat{A}_{𝐦,j}$</span> for <em>single</em> sublattice <span>$j$</span>. It can also be written,</p><p class="math-container">\[\begin{equation}
\hat{A}_{𝐪,j} = e^{i 𝐪⋅δ𝐫_j} \sum_𝐦 e^{i 2π \tilde{𝐪}⋅𝐦} \hat{A}_{𝐦,j},
\end{equation}\]</p><p>where <span>$\tilde{𝐪}$</span> expresses momentum in dimensionless reciprocal lattice units (RLU),</p><p class="math-container">\[\begin{equation}
𝐪 = \tilde{q}_1 𝐛_1 + \tilde{q}_2 𝐛_2 + \tilde{q}_3 𝐛_3,
\end{equation}\]</p><p>and <span>$𝐛_{\{1,2,3\}}$</span> are the reciprocal lattice vectors. Equivalently, <span>$\tilde{q}_μ ≡ 𝐪 ⋅ 𝐚_μ / 2π$</span>.</p><p>It will be convenient to introduce a dynamical correlation for the operators on sublattices <span>$i$</span> and <span>$j$</span> only,</p><p class="math-container">\[\begin{equation}
C_{ij}(𝐪,t) ≡ ⟨\hat{B}^†_{𝐪,i}(0) \hat{A}_{𝐪,j}(t)⟩.
\end{equation}\]</p><p>By the linearity of expectation values,</p><p class="math-container">\[\begin{equation}
C(𝐪, t) = \sum_{ij} C_{ij}(𝐪,t).
\end{equation}\]</p><h2 id="Quantum-sum-rule"><a class="docs-heading-anchor" href="#Quantum-sum-rule">Quantum sum rule</a><a id="Quantum-sum-rule-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-sum-rule" title="Permalink"></a></h2><p>Integrating over all frequencies <span>$ω$</span> yields the instant correlation at real-time <span>$t = 0$</span>,</p><p class="math-container">\[\begin{equation}
\int_{-∞}^∞ C(𝐪,ω) dω = C(𝐪, t=0) = \sum_{ij} C_{ij}(𝐪, t=0).
\end{equation}\]</p><p>Here, we will investigate spin-spin correlations. For this, select <span>$\hat{B}_{𝐪,i} = \hat{𝐒}_{𝐪,i}$</span> and <span>$A_{𝐪,j} = \hat{𝐒}_{𝐪,j}$</span>, such that the dynamical correlations become tensor valued,</p><p class="math-container">\[\begin{equation}
C_{ij}^{αβ}(𝐪, t=0) = ⟨\hat{S}_{𝐪,i}^{α†} \hat{S}_{𝐪,j}^{β}⟩.
\end{equation}\]</p><p>In the quantum spin-<span>$s$</span> representation, the spin dipole on one site satisfies</p><p class="math-container">\[\begin{equation}
|\hat{𝐒}|^2 = \hat{S}^α \hat{S}^α = s(s+1),
\end{equation}\]</p><p>with implicit summation on the repeated <span>$α$</span> index.</p><p>Suppose that each site of sublattice <span>$j$</span> carries quantum spin of magnitude <span>$s_j$</span>. Then there is a quantum sum rule of the form,</p><p class="math-container">\[\begin{equation}
\int_{\tilde{V}_\mathrm{BZ}} \frac{C_{jj}^{αα}(𝐪, t=0)}{N_\mathrm{cells}} d\tilde{𝐪} = s_j (s_j + 1),
\end{equation}\]</p><p>with summation on <span>$α$</span>, but not <span>$j$</span>, implied. The integral runs over the cubic volume in reciprocal lattice units <span>$\tilde{𝐪}$</span>,</p><p class="math-container">\[\begin{equation}
\tilde{V}_\mathrm{BZ} ≡ [0,1]^3.
\end{equation}\]</p><p>This volume represents one unit cell on the reciprocal lattice, and has the shape of a parallelepiped in physical momentum units <span>$𝐪$</span>. This volume is equivalent to the first Brillouin zone because of the reciprocal-space periodicity inherent to the Bravais sublattice. Note that the integral over <span>$\tilde{𝐪} ∈ \tilde{V}_\mathrm{BZ}$</span> could be converted to an integral over physical momentum <span>$𝐪$</span> by applying a Jacobian transformation factor, <span>$d \tilde{𝐪} = d𝐪 V_\mathrm{cell} / (2π)^3$</span>, where <span>$V_\mathrm{cell} = |𝐚_1 ⋅ (𝐚_2 × 𝐚_3)|$</span> is the volume of the chemical unit cell. The scaling factor</p><p class="math-container">\[\begin{equation}
N_\mathrm{cells} ≡ V / V_\mathrm{cell}
\end{equation}\]</p><p>denotes the number of chemical unit cells in the macroscopic volume <span>$V$</span>.</p><p>The derivation of the sum rule proceeds as follows. Substitute twice the definition,</p><p class="math-container">\[\begin{equation}
\hat{S}^α_{𝐪,j} ≡ e^{i 𝐪⋅δ𝐫_j} \sum_𝐦 e^{i 2π \tilde{𝐪}⋅𝐦} \hat{S}^α_{𝐦,j}.
\end{equation}\]</p><p>Accounting for complex conjugation, the two phase factors <span>$e^{i 𝐪⋅δ𝐫_j}$</span> cancel. The remaining <span>$𝐪$</span>-dependence can be integrated to yield a Kronecker-<span>$δ$</span>,</p><p class="math-container">\[\begin{equation}
\int_{\tilde{V}_\mathrm{BZ}} e^{2πi \tilde{𝐪} ⋅ (𝐦 - 𝐦&#39;) } d\tilde{𝐪} = δ_{𝐦, 𝐦&#39;}.
\end{equation}\]</p><p>Note that <span>$⟨\hat{S}_{𝐦,j}^α \hat{S}_{𝐦,j}^α⟩ = s_j(s_j+1)$</span> is constant, independent of the cell <span>$𝐦$</span>. This leaves a double sum over integers <span>$𝐦$</span>, which evaluates to <span>$\sum_{𝐦, 𝐦&#39;} δ_{𝐦, 𝐦&#39;} = N_\mathrm{cells}$</span>. Combined, these results verify the above-stated quantum sum rule for the sublattice <span>$j$</span>.</p><p>One can also derive a quantum sum rule on the full dynamical correlation <span>$C^{α, β}(𝐪, ω)$</span>. Contributions from distinct sublattices <span>$i ≠ j$</span> introduce a phase factor <span>$e^{- i 𝐪⋅(δ𝐫_i - δ𝐫_j)}$</span> that cancels when the momentum <span>$𝐪$</span> is averaged over a large number <span>$N_\mathrm{BZ} → ∞$</span> of Brillouin zones. The final result is a sum over contributions <span>$C_{jj}(𝐪, t=0)$</span> for each sublattice <span>$j$</span>,</p><p class="math-container">\[\begin{equation}
\frac{1}{N_\mathrm{BZ}} \int_{N_\mathrm{BZ} × \tilde{V}_\mathrm{BZ}} \int_{-∞}^∞ \frac{C^{αα}(𝐪, ω)}{ N_\mathrm{cells}} dω d\tilde{𝐪} = \sum_j s_j (s_j + 1).
\end{equation}\]</p><h2 id="Neutron-scattering-cross-section"><a class="docs-heading-anchor" href="#Neutron-scattering-cross-section">Neutron scattering cross section</a><a id="Neutron-scattering-cross-section-1"></a><a class="docs-heading-anchor-permalink" href="#Neutron-scattering-cross-section" title="Permalink"></a></h2><p>The magnetic moment of a neutron is <span>$\hat{\boldsymbol{μ}}_\mathrm{neutron} = - 2 γ μ_N \hat{𝐒}_\mathrm{neutron}$</span>, where <span>$γ = 1.913…$</span>, <span>$μ_N$</span> is the nuclear magneton, and <span>$\hat{𝐒}_\mathrm{neutron}$</span> is spin-1/2 angular momentum. Neutrons interact with the magnetic moments of a material. These have the form <span>$\hat{\boldsymbol{μ}} = -μ_B g \hat{𝐒}$</span>, where <span>$μ_B$</span> is the Bohr magneton and <span>$\hat{𝐒}$</span> is the effective angular momentum. For a single electron, <span>$g = 2.0023…$</span> is known to high precision. Within a crystal, however, the appropriate <span>$g_j$</span> for each sublattice <span>$j$</span> may be any <span>$3×3$</span> matrix consistent with point group symmetries.</p><p>Each idealized magnetic moment <span>$\hat{\boldsymbol{μ}}_{𝐦,j}$</span> is, in reality, smoothly distributed around the site position <span>$𝐫_{𝐦, j}$</span>. This can be modeled through convolution with a density function <span>$f_j(𝐫)$</span>. Fourier transform the full magnetic density field <span>$𝐌(𝐫)$</span> to obtain</p><p class="math-container">\[\begin{equation}
\hat{𝐌}_𝐪 ≡ \sum_j \hat{𝐌}_{𝐪,j},
\end{equation}\]</p><p>where,</p><p class="math-container">\[\begin{equation}
\hat{𝐌}_{𝐪,j} ≡ - μ_B e^{i 𝐪⋅δ𝐫_j} g_j \sum_𝐦 e^{i 2π \tilde{𝐪}⋅𝐦} \hat{𝐒}_{𝐦,j} f_j(𝐪).
\end{equation}\]</p><p>In Fourier space, <span>$f_j(𝐪)$</span> is called the <em>magnetic form factor</em>. Frequently, it will be approximated as an isotropic function of <span>$q = |𝐪|$</span>. Tabulated formula, for various magnetic ions and charge states, are available in Sunny via the <a href="library.html#Sunny.FormFactor"><code>FormFactor</code></a> function. The idealized case <span>$f_j(𝐪) = 1$</span> would describe completely localized magnetic moments.</p><p>Neutron scattering intensities are given by the total differential cross-section, <span>$d^2 σ(𝐪, ω)/dωdΩ$</span>, where <span>$𝐪 = 𝐪_i - 𝐪_f$</span> is the momentum transfer to the sample, <span>$ω$</span> is the energy transfer to the sample, and <span>$Ω$</span> is the solid angle. Experimental intensity data will typically be provided in units of <span>$q_f / q_i$</span>. Within the dipole approximation, the result for an unpolarized neutron beam is,</p><p class="math-container">\[\begin{equation}
\frac{d^2 σ(𝐪, ω)}{dω dΩ} = \frac{q_f}{q_i} \left(\frac{γ r_0}{2}\right)^2 \sum_{α,β} \left(δ_{α,β} - \frac{q^α q^β}{q^2}\right) \frac{\mathcal{S}^{αβ}(𝐪, ω)}{μ_B^2}.
\end{equation}\]</p><p>The prefactor <span>$q_f/q_i$</span> will be provided experimentally. Dimensions of area arise from the characteristic scattering length, <span>$γ r_0 / 2 ≈ 2.69×10^{-5} \mathrm{Å}$</span>, where <span>$r_0$</span> is the classical electron radius.</p><p>The structure factor is of central importance to neutron scattering,</p><p class="math-container">\[\begin{equation}
\mathcal{S}^{αβ}(𝐪, ω) ≡ \frac{1}{2π} \int_{-∞}^{∞} e^{-iωt} ⟨\hat{M}_𝐪^{α†}(0) \hat{M}_𝐪^β(t)⟩ dt,
\end{equation}\]</p><p>and describes dynamical correlations of magnetic moments. It will differ nontrivially from the spin-spin correlations if the <span>$g_j$</span>-tensor varies with sublattice <span>$j$</span>.</p><h2 id="Conventions-for-the-Sunny-calculated-structure-factor"><a class="docs-heading-anchor" href="#Conventions-for-the-Sunny-calculated-structure-factor">Conventions for the Sunny-calculated structure factor</a><a id="Conventions-for-the-Sunny-calculated-structure-factor-1"></a><a class="docs-heading-anchor-permalink" href="#Conventions-for-the-Sunny-calculated-structure-factor" title="Permalink"></a></h2><p>Calculating the structure factor involves several steps, with various possible settings. Sunny provides tools to facilitate this calculation and to extract information from the results. For details, please see our <a href="examples/01_LSWT_CoRh2O4.html#1.-Spin-wave-simulations-of-CoRhO">tutorials</a> as well as the complete <a href="library.html#Library-Reference">Library Reference</a>.</p><p>Through <a href="library.html#Sunny.ssf_custom"><code>ssf_custom</code></a> and related functions, Sunny will calculate the spin structure factor as a 3×3 matrix in dimensionless units,</p><p class="math-container">\[\begin{equation}
𝒮^{αβ}(𝐪, ω) ≡ \frac{1}{N_\mathrm{cells} μ_B^2} \mathcal{S}^{αβ}(𝐪, ω),
\end{equation}\]</p><p>This is an intensive quantity because <span>$N_\mathrm{cells}$</span>, the number of chemical cells in the macroscopic sample, is extensive. Note that the Sunny-calculated intensity will depend on the chemical cell convention: intensity scales linearly with chemical cell size.</p><p>Use <a href="library.html#Sunny.ssf_perp"><code>ssf_perp</code></a> to contract with <span>$δ_{α,β} - q^α q^β/q^2$</span>, i.e., to project in the direction perpendicular to momentum transfer <span>$𝐪$</span>.</p><p>Set <code>apply_g = false</code> to calculate the correlation <span>$C_{⟨𝐒𝐒⟩}(𝐪, ω) / N_\mathrm{cells}$</span> between pure spin operators, rather than between magnetic moments. In this special case that <span>$g$</span> is a uniform scalar, this is equivalent to <span>$𝒮(𝐪, ω) / g^2$</span></p><h2 id="Calculations-with-spin-wave-theory"><a class="docs-heading-anchor" href="#Calculations-with-spin-wave-theory">Calculations with spin wave theory</a><a id="Calculations-with-spin-wave-theory-1"></a><a class="docs-heading-anchor-permalink" href="#Calculations-with-spin-wave-theory" title="Permalink"></a></h2><p>Calculating the dynamical structure factor with linear <a href="library.html#Sunny.SpinWaveTheory"><code>SpinWaveTheory</code></a> is relatively direct. In the traditional approach, quantum spin operators are expressed with Holstein-Primakoff bosons, and dynamical correlations are calculated to leading order in inverse powers of the quantum spin-<span>$s$</span>. For systems constructed with <code>mode = :SUN</code>, Sunny automatically switches to a multi-flavor boson variant of spin wave theory, which captures more single-ion physics. Use <a href="library.html#Sunny.SpinWaveTheorySpiral"><code>SpinWaveTheorySpiral</code></a> to study generalized spiral phases, which allow for an incommensurate propagation wavevector. The experimental module <a href="library.html#Sunny.SpinWaveTheoryKPM"><code>SpinWaveTheoryKPM</code></a> implements <a href="https://arxiv.org/abs/2312.0834">spin wave calculations using the kernel polynomial method</a>. In the KPM approach, the computational cost scales linearly in the magnetic cell size. It can be useful for studying systems with large magnetic cells include systems with long-wavelength structures, or systems with quenched chemical disorder.</p><h2 id="Calculations-with-classical-spin-dynamics"><a class="docs-heading-anchor" href="#Calculations-with-classical-spin-dynamics">Calculations with classical spin dynamics</a><a id="Calculations-with-classical-spin-dynamics-1"></a><a class="docs-heading-anchor-permalink" href="#Calculations-with-classical-spin-dynamics" title="Permalink"></a></h2><p>Finite temperature structure factor intensities can be estimated from the dynamical correlations of classical spin dynamics (e.g. Landau-Lifshitz, or its SU(<span>$N$</span>) generalization). This is fundamentally a Monte Carlo approach, as the trajectories must be initialized to a spin configuration that is sampled from the finite-temperature thermal equilibrium. Samples are accumulated into a <a href="library.html#Sunny.SampledCorrelations"><code>SampledCorrelations</code></a>, from which intensity information may be extracted.</p><p>Creating a <code>SampledCorrelations</code> requires specifying three keyword arguments. These will determine the dynamics used to calculate samples and, consequently, the <span>$ω$</span> information that will be available. </p><ol><li><code>energies</code>: A uniform range of resolved energies.</li><li><code>dt</code>: The step size for dynamical time-integration. Larger may reduce simulation time, but the choice will be limited by the stability and accuracy requirements of the <a href="library.html#Sunny.ImplicitMidpoint"><code>ImplicitMidpoint</code></a> integration method. The function <a href="library.html#Sunny.suggest_timestep"><code>suggest_timestep</code></a> can recommend a good value. The timestep may be adjusted downward so that the specified <code>energies</code> are sampled exactly.</li><li><code>measure</code>: Specification of the pair correlations. This will frequently be reduced from the spin structure factor using one of <a href="library.html#Sunny.ssf_trace"><code>ssf_trace</code></a>, <a href="library.html#Sunny.ssf_perp"><code>ssf_perp</code></a>, or <a href="library.html#Sunny.ssf_custom_bm"><code>ssf_custom_bm</code></a>.</li></ol><p>A sample may be added by calling <a href="library.html#Sunny.add_sample!"><code>add_sample!</code></a>. The input <code>sys</code> must be a spin configuration in good thermal equilibrium, e.g., using the continuous <a href="library.html#Sunny.Langevin"><code>Langevin</code></a> dynamics or using single spin flip trials with <a href="library.html#Sunny.LocalSampler"><code>LocalSampler</code></a>. The statistical quality of the <span>$𝒮(𝐪,ω)$</span> can be improved by repeatedly generating decorrelated spin configurations in <code>sys</code> and calling <code>add_sample!</code> on each configuration.</p><p>The outline of typical use case might look like this:</p><pre><code class="nohighlight hljs"># Make a `SampledCorrelations`
sc = SampledCorrelations(sys; dt=0.05, energies=range(0.0, 10.0, 100))

# Add samples
for _ in 1:nsamples
   decorrelate_system(sys) # Perform some type of Monte Carlo simulation
   add_sample!(sc, sys)    # Use spins to calculate trajectory and accumulate new sample of 𝒮(𝐪,ω)
end</code></pre><h3 id="Extracting-intensities-sampled-correlation-data"><a class="docs-heading-anchor" href="#Extracting-intensities-sampled-correlation-data">Extracting intensities sampled correlation data</a><a id="Extracting-intensities-sampled-correlation-data-1"></a><a class="docs-heading-anchor-permalink" href="#Extracting-intensities-sampled-correlation-data" title="Permalink"></a></h3><p>Like in spin wave theory, the basic function for extracting intensities information from a <code>SampledCorrelations</code> is <a href="library.html#Sunny.intensities"><code>intensities</code></a>. It takes a <code>SampledCorrelations</code>, a collection of <span>$𝐪$</span>-vectors, a collection of <code>energies</code>, and possible other options.</p><p>Since classical dynamics simulation take place on a finite lattice, the fundamental intensities measurements are only available at a discrete grid of wave vectors. In reciprocal lattice units, available grid points are <span>$𝐪 = [\frac{n_1}{L_1}, \frac{n_2}{L_2}, \frac{n_3}{L_3}]$</span>, where <span>$n_i$</span> runs from <span>$(\frac{-L_i}{2}+1)$</span> to <span>$\frac{L_i}{2}$</span> and <span>$L_i$</span> is the linear dimension of the lattice used in the calculation. (An internal function <code>Sunny.available_wave_vectors</code> provides access to this grid.) By default <a href="library.html#Sunny.intensities"><code>intensities</code></a> will adjust each wavevector <span>$𝐪$</span> to the nearest available grid point. </p><p>Similarly, the resolution in <code>energies</code> is controlled the dynamical trajectory length in real-time. Because the dynamical trajectory is not periodic in time, some blurring between neighboring energy bins is unavoidable. Sunny&#39;s algorithm for estimating the structure factor from real-time dynamics is <a href="https://github.com/SunnySuite/Sunny.jl/pull/246#issuecomment-2119294846">specified here</a>.</p><p>The temperature parameter <code>kT</code> is required for <code>SampledCorrelations</code> calculations, and will be used to perform classical-to-quantum rescaling of intensities. If <code>kT = nothing</code>, then intensities will be provided according to the classical Boltzmann distribution.</p><h3 id="The-instantaneous-structure-factor"><a class="docs-heading-anchor" href="#The-instantaneous-structure-factor">The instantaneous structure factor</a><a id="The-instantaneous-structure-factor-1"></a><a class="docs-heading-anchor-permalink" href="#The-instantaneous-structure-factor" title="Permalink"></a></h3><p>Use <a href="library.html#Sunny.intensities_static"><code>intensities_static</code></a> to calculate <span>$\mathcal{S}(𝐪)$</span>, i.e.,  correlations that are &quot;instantaneous&quot; in real-time. Mathematically, <span>$\mathcal{S}(𝐪)$</span> denotes an integral of the dynamical structure factor <span>$\mathcal{S}(𝐪, ω)$</span> over all energies <span>$ω$</span>. In <a href="library.html#Sunny.SpinWaveTheory"><code>SpinWaveTheory</code></a>, the energy integral becomes a discrete sum over bands. In <a href="library.html#Sunny.SampledCorrelations"><code>SampledCorrelations</code></a>, a classical-to-quantum correction factor will be applied within <a href="library.html#Sunny.intensities"><code>intensities</code></a> prior to energy integration.</p><p>Sunny also supports a mechanism to calculate static correlations without any spin dynamics. To collect such statistics, construct a <code>SampledCorrelationsStatic</code> object. In this case, <code>intensities_static</code> will return static correlations sampled from the classical Boltzmann distribution. This dynamics-free approach is faster, but may miss important features that derive from the quantum mechanical excitation spectrum.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="library.html">« Library Reference</a><a class="docs-footer-nextpage" href="renormalization.html">Interaction Renormalization »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Friday 6 December 2024 22:31">Friday 6 December 2024</span>. Using Julia version 1.10.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
